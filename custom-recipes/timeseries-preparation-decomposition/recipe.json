{
  "meta": {
    "label": "Timeseries decomposition",
    "description": "Decompose your timeseries into trend, seasonality and residuals.",
    "icon": "icon-calendar-empty",
    "displayOrderRank": 5
  },
  "kind": "PYTHON",
  "selectableFromDataset": "input_dataset",
  "inputRoles": [
    {
      "name": "input_dataset",
      "label": "Historical dataset",
      "description": "A dataset which contains time series data",
      "arity": "UNARY",
      "required": true,
      "acceptsDataset": true,
      "acceptsManagedFolder": false
    }
  ],
  "outputRoles": [
    {
      "name": "output_dataset",
      "label": "Transformation results",
      "description": "Dataset resulting from the time series transformation",
      "arity": "UNARY",
      "required": true,
      "acceptsDataset": true,
      "acceptsManagedFolder": false
    }
  ],
  "params": [
    {
      "type": "SEPARATOR",
      "name": "separator_input",
      "label": "Input parameters"
    },
    {
      "name": "time_column",
      "label": "Time column",
      "allowedColumnTypes": [
        "date"
      ],
      "type": "COLUMN",
      "description": "Must be a parsed date",
      "columnRole": "input_dataset",
      "mandatory": true
    },
    {
      "name": "frequency_unit",
      "label": "Frequency",
      "type": "SELECT",
      "description": "Frequency of your historical data",
      "mandatory": true,
      "selectChoices": [
        {
          "value": "min",
          "label": "Minute"
        },
        {
          "value": "H",
          "label": "Hour"
        },
        {
          "value": "D",
          "label": "Day"
        },
        {
          "value": "B",
          "label": "Business Day (Mon-Fri)"
        },
        {
          "value": "W",
          "label": "Week"
        },
        {
          "value": "M",
          "label": "Month"
        },
        {
          "value": "3M",
          "label": "Quarter"
        },
        {
          "value": "6M",
          "label": "Semester (semi-annual)"
        },
        {
          "value": "12M",
          "label": "Year"
        }
      ],
      "defaultValue": "D"
    },
    {
      "name": "season_length_min",
      "label": "Season length",
      "description": "Length of the seasonal period",
      "type": "INT",
      "defaultValue": 1,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'min'"
    },
    {
      "name": "season_length_H",
      "label": "Season length",
      "description": "Length of the seasonal period.",
      "type": "INT",
      "defaultValue": 24,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'H'"
    },
    {
      "name": "season_length_D",
      "label": "Season length",
      "description": "Length of the seasonal period (in days).",
      "type": "INT",
      "defaultValue": 7,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'D'"
    },
    {
      "name": "season_length_B",
      "label": "Season length",
      "description": "Length of the seasonal period (in business days).",
      "type": "INT",
      "defaultValue": 5,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'B'"
    },
    {
      "name": "season_length_W",
      "label": "Season length",
      "description": "Length of the seasonal period (in weeks).",
      "type": "INT",
      "defaultValue": 52,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'W'"
    },
    {
      "name": "season_length_M",
      "label": "Season length",
      "description": "Length of the seasonal period (in months).",
      "type": "INT",
      "defaultValue": 12,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == 'M'"
    },
    {
      "name": "season_length_3M",
      "label": "Season length",
      "description": "Length of the seasonal period (in quarters).",
      "type": "INT",
      "defaultValue": 4,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == '3M'"
    },
    {
      "name": "season_length_6M",
      "label": "Season length",
      "description": "Length of the seasonal period (in semesters).",
      "type": "INT",
      "defaultValue": 2,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == '6M'"
    },
    {
      "name": "season_length_12M",
      "label": "Season length",
      "description": "Length of the seasonal period (in years).",
      "type": "INT",
      "defaultValue": 1,
      "mandatory": false,
      "visibilityCondition": "model.frequency_unit == '12M'"
    },
    {
      "name": "target_columns",
      "label": "Target column(s)",
      "type": "COLUMNS",
      "allowedColumnTypes": [
        "tinyint",
        "smallint",
        "int",
        "bigint",
        "float",
        "double"
      ],
      "columnRole": "input_dataset",
      "mandatory": true
    },
    {
      "name": "long_format",
      "label": "Long format",
      "description": "If multiple time series are stored in the same column",
      "type": "BOOLEAN",
      "defaultValue": false,
      "mandatory": true
    },
    {
      "name": "timeseries_identifiers",
      "label": "Time series identifiers",
      "description": "Columns that identify the multiple time series - mandatory for long format",
      "type": "COLUMNS",
      "allowedColumnTypes": [
        "tinyint",
        "smallint",
        "int",
        "bigint",
        "string",
        "boolean"
      ],
      "columnRole": "input_dataset",
      "mandatory": false,
      "visibilityCondition": "model.long_format"
    },
    {
      "type": "SEPARATOR",
      "name": "separator_decomposition",
      "label": "Decomposition parameters"
    },
    {
      "name": "time_decomposition_method",
      "label": "Select a decomposition method",
      "type": "SELECT",
      "selectChoices": [
        {
          "value": "STL",
          "label": "STL"
        },
        {
          "value": "classical",
          "label": "Classical decomposition"
        }
      ],
      "defaultValue": "STL"
    },
    {
      "type": "SEPARATOR",
      "name": "stl_parameters",
      "label": "",
      "description": "Seasonal-Trend decomposition using Loess",
      "visibilityCondition": "model.time_decomposition_method == 'STL'"
    },
    {
      "type": "SEPARATOR",
      "name": "classical_parameters",
      "label": "",
      "description": "Seasonal-Trend decomposition using moving averages",
      "visibilityCondition": "model.time_decomposition_method == 'classical'"
    },
    {
      "type": "SELECT",
      "name": "decomposition_model",
      "label": "Model type",
      "selectChoices": [
        {
          "value": "additive",
          "label": "Additive"
        },
        {
          "value": "multiplicative",
          "label": "Multiplicative"
        }
      ],
      "defaultValue": "additive",
      "description": " If the magnitude of the seasonality varies over time, then the series is multiplicative. Otherwise, the series is additive."
    },
    {
      "name": "seasonal_stl",
      "label": "Seasonal smoother",
      "type": "INT",
      "description": "Odd integer. Number of consecutive timesteps (years, weeks..) to be used in estimating each value in the seasonal component. It controls how rapidly the seasonal component can change.",
      "defaultValue": 13,
      "minI": 7,
      "visibilityCondition": "model.time_decomposition_method == 'STL'"
    },
    {
      "type": "SEPARATOR",
      "name": "advanced_parameters",
      "label": "Advanced parameters"
    },
    {
      "name": "expert",
      "label": "Expert mode",
      "type": "BOOLEAN",
      "defaultValue": false
    },
    {
      "name": "robust_stl",
      "label": "Robust to outliers",
      "type": "BOOLEAN",
      "defaultValue": false,
      "mandatory": false,
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert",
      "description": "If selected, the estimation will re-weight data, allowing the model to tolerate larger errors."
    },
    {
      "type": "SEPARATOR",
      "name": "separator_degrees",
      "label": " ",
      "description": "Fitting method in Loess",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert"
    },
    {
      "name": "stl_degree_kwargs",
      "type": "MAP",
      "label": "Degree of Loess",
      "description": "Keyword argument ⟶ value cf. https://www.statsmodels.org/devel/generated/statsmodels.tsa.seasonal.STL.html",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert",
      "mandatory": false,
      "defaultValue": {
        "seasonal_deg": "1",
        "trend_deg": "1",
        "low_pass_deg": "1"
      }
    },
    {
      "type": "SEPARATOR",
      "name": "separator_speedup",
      "label": " ",
      "description": "Performance",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert"
    },
    {
      "type": "SEPARATOR",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert"
    },
    {
      "name": "stl_speed_jump_kwargs",
      "type": "MAP",
      "label": "Speed jump",
      "description": "Keyword argument ⟶ value cf. https://www.statsmodels.org/devel/generated/statsmodels.tsa.seasonal.STL.html",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert",
      "mandatory": false,
      "defaultValue": {
        "seasonal_jump": "1",
        "trend_jump": "1",
        "low_pass_jump": "1"
      }
    },
    {
      "type": "SEPARATOR",
      "name": "separator_smoothers",
      "label": " ",
      "description": "Additional smoothers",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert"
    },
    {
      "type": "SEPARATOR",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert"
    },
    {
      "name": "stl_smoothers_kwargs",
      "type": "MAP",
      "label": "Length of the smoothers",
      "description": "Keyword argument ⟶ value cf. https://www.statsmodels.org/devel/generated/statsmodels.tsa.seasonal.STL.html",
      "visibilityCondition": "model.time_decomposition_method == 'STL' && model.expert",
      "mandatory": false,
      "defaultValue": {
        "trend": "",
        "low_pass": ""
      }
    },
    {
      "name": "advanced_params_classical",
      "type": "MAP",
      "label": " ",
      "description": "Keyword argument ⟶ value https://www.statsmodels.org/stable/generated/statsmodels.tsa.seasonal.seasonal_decompose.html",
      "visibilityCondition": "model.time_decomposition_method == 'classical' && model.expert",
      "mandatory": false,
      "defaultValue": {
        "filt": "",
        "two_sided": "True",
        "extrapolate_trend": "0"
      }
    }
  ],
  "resourceKeys": []
}
